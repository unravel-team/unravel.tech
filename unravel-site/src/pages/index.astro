---
import BaseLayout from '../layouts/BaseLayout.astro';
import ScrollProgress from '../components/ScrollProgress';
import BentoHero from '../components/BentoHero.astro';
import BentoGrid from '../components/BentoGrid.astro';
import BentoService from '../components/BentoService.astro';
import BentoStats from '../components/BentoStats.astro';
import BentoCard from '../components/BentoCard.astro';
import BentoTestimonial from '../components/BentoTestimonial.astro';
---

<ScrollProgress client:load />

<BaseLayout 
  title="Unravel | Enterprise AI Agents"
  description="AI agents that survive real users. Handle unhappy paths, save money and scale with your business."
>
  <!-- Hero Section - Cream Background -->
  <BentoHero 
    title=""
    subtitle="We build AI agents that survive real users. Handle unhappy paths, save money, and scale with your business."
    ctaPrimary={{ text: "Start Your Project", href: "#contact" }}
    ctaSecondary={{ text: "See What We Do", href: "#services" }}
  />

  <!-- Services Grid - Warm White Background with Bento Layout -->
  <section class="section-warm" id="services">
    <div class="container">
      <div class="section-header text-center">
        <h2>What we build</h2>
        <p>Production-ready AI that handles the messy reality of real users</p>
      </div>

      <!-- Bento Grid - Asymmetric Layout -->
      <div class="bento-grid-custom">
        <!-- Row 1: Large Feature + Stat -->
        <BentoCard span="8" padding="none" class="featured-service">
          <BentoService 
            featured={true}
            icon="ðŸ¤–"
            title="AI Agents That Don't Break"
            description="Production-grade agents that handle edge cases, recover from failures, and scale with your business. No demos that fall apart under real load."
            features={['Multi-agent orchestration', 'Error recovery & fallbacks', 'Cost-optimized inference']}
          />
        </BentoCard>

        <BentoCard span="4" padding="none" class="stat-highlight">
          <BentoStats 
            number="4mo"
            label="Average time from prototype to production"
            variant="gradient"
          />
        </BentoCard>

        <!-- Row 2: Two Medium Cards -->
        <BentoCard span="6" padding="none">
          <BentoService 
            icon="ðŸ’¬"
            title="NLP That Actually Works"
            description="Build chatbots and document processors that understand context, not just keywords. Handle ambiguity, multiple languages, and domain jargon."
          />
        </BentoCard>

        <BentoCard span="6" padding="none">
          <BentoService 
            icon="ðŸ“Š"
            title="Smart Data Pipelines"
            description="Turn unstructured data into insights. ML-powered classification, extraction, and anomaly detection that scales."
          />
        </BentoCard>

        <!-- Row 3: Stat + Service + Stat -->
        <BentoCard span="3" padding="none">
          <BentoStats 
            number="30%"
            label="Average cost savings vs DIY approach"
          />
        </BentoCard>

        <BentoCard span="6" padding="none">
          <BentoService 
            icon="ðŸ‘ï¸"
            title="Computer Vision"
            description="Visual inspection, quality control, and object detection. From manufacturing floors to retail shelves."
          />
        </BentoCard>

        <BentoCard span="3" padding="none">
          <BentoStats 
            number="70+"
            label="Years combined engineering experience"
          />
        </BentoCard>
      </div>
    </div>
  </section>

  <!-- Why Us - Cream Background -->
  <section class="section-cream">
    <div class="container">
      <div class="section-header text-center">
        <h2>Why teams choose Unravel</h2>
        <p>We're not just consultantsâ€”we're your AI engineering team</p>
      </div>

      <BentoGrid columns="2" gap="lg">
        <BentoCard span="1" padding="none">
          <BentoService 
            icon="2W"
            title="Fast iteration"
            description="Working prototype in 2 weeks. Full production system in 4 months. No endless consulting cycles."
          />
        </BentoCard>

        <BentoCard span="1" padding="none">
          <BentoService 
            icon="PRO"
            title="Production-grade"
            description="We handle the boring stuff: error handling, monitoring, scaling, and all the edge cases that break demos."
          />
        </BentoCard>

        <BentoCard span="1" padding="none">
          <BentoService 
            icon="30%"
            title="Cost-conscious"
            description="We optimize for your wallet. Smart model selection, caching, and infrastructure choices that cut costs by 30%+."
          />
        </BentoCard>

        <BentoCard span="1" padding="none">
          <BentoService 
            icon="ROI"
            title="Business outcomes"
            description="We measure success by your metrics: cost savings, time saved, revenue generatedâ€”not lines of code."
          />
        </BentoCard>
      </BentoGrid>
    </div>
  </section>

  <!-- Testimonials - Warm White Background -->
  <section class="section-warm">
    <div class="container">
      <div class="section-header text-center">
        <h2>Trusted by Engineering Leaders</h2>
      </div>

      <BentoGrid columns="2" gap="lg">
        <BentoCard span="1" padding="none">
          <BentoTestimonial 
            quote="The Unravel team embodies a unique combination of leaders and hackers. They are seasoned developers and their work-product is fast, reliable and delightful!"
            authorName="Vishwesh Jirgale"
            authorTitle="Head of Engineering, Modern Loop"
          />
        </BentoCard>

        <BentoCard span="1" padding="none">
          <BentoTestimonial 
            quote="Unravel built our complete event-ingestion pipeline. Their distributed systems expertise let me focus on business outcomesâ€”a partnership we'll gladly continue."
            authorName="Kedar Sovani"
            authorTitle="India Head, Espressif Systems"
          />
        </BentoCard>
      </BentoGrid>
    </div>
  </section>

  <!-- CTA - Cream Background -->
  <section class="section-cream" id="contact">
    <div class="container">
      <div class="cta-card text-center">
        <h2>Ready to build something real?</h2>
        <p>Let's talk about your AI project. No sales pitchâ€”just an honest conversation about what's possible.</p>
        <a href="mailto:hello@unravel.tech" class="btn btn-primary btn-lg bg-white text-green">hello@unravel.tech</a>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  /* Section Styles using Brand Colors */
  .section-cream {
    background-color: var(--color-bg-cream);
    padding: var(--spacing-3xl) 0;
  }

  .section-warm {
    background-color: var(--color-bg-warm);
    padding: var(--spacing-3xl) 0;
  }

  .section-header {
    margin-bottom: 4rem;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }

  .section-header h2 {
    font-size: clamp(2rem, 4vw, 2.75rem);
    margin-bottom: 1rem;
    color: var(--color-text-primary);
  }

  .section-header p {
    font-size: 1.25rem;
    color: var(--color-text-secondary);
  }

  /* CTA Card */
  .cta-card {
    background: var(--unravel-green);
    color: white;
    border-radius: 20px;
    padding: 4rem 2rem;
    max-width: 800px;
    margin: 0 auto;
    box-shadow: 0 20px 40px rgba(111, 191, 63, 0.2);
  }

  .cta-card h2 {
    color: white;
    margin-bottom: 1.5rem;
  }

  .cta-card p {
    font-size: 1.25rem;
    margin-bottom: 2.5rem;
    opacity: 0.95;
    color: white;
  }

  .cta-card .btn {
    background: white;
    color: var(--unravel-green);
    border: none;
  }

  .cta-card .btn:hover {
    background: #F0FDF4;
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
  }

  /* Custom Bento Grid - Asymmetric Magazine Layout */
  .bento-grid-custom {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 1.5rem;
    width: 100%;
  }

  /* Featured service gets more space */
  .featured-service {
    grid-column: span 8;
  }

  .stat-highlight {
    grid-column: span 4;
  }

  /* Enhanced card styling */
  .bento-grid-custom .bento-card {
    min-height: 240px;
    display: flex;
    align-items: stretch;
  }

  .featured-service .bento-card {
    min-height: 320px;
  }

  /* Tablet Layout - Adjust spans */
  @media (min-width: 641px) and (max-width: 1024px) {
    .bento-grid-custom {
      grid-template-columns: repeat(8, 1fr);
    }

    .featured-service {
      grid-column: span 8;
    }

    .stat-highlight {
      grid-column: span 8;
    }

    .bento-grid-custom .bento-card[span="6"] {
      grid-column: span 4;
    }

    .bento-grid-custom .bento-card[span="3"] {
      grid-column: span 4;
    }
  }

  /* Mobile Layout - Stack everything */
  @media (max-width: 640px) {
    .bento-grid-custom {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .bento-grid-custom .bento-card {
      grid-column: span 1 !important;
      min-height: 200px;
    }

    .featured-service,
    .stat-highlight {
      grid-column: span 1 !important;
    }

    .section-header {
      margin-bottom: 3rem;
    }
    
    .cta-card {
      padding: 3rem 1.5rem;
    }
  }
</style>

<script>
  import { trackHeroInteraction, trackContactAttempt } from '../lib/posthog';

  // Re-attach listeners since DOM structure changed slightly
  function initTracking() {
    // Selectors might need to be more robust if structure changes
    const heroPrimaryCta = document.querySelector('.bento-hero-actions .btn-primary');
    const heroSecondaryCta = document.querySelector('.bento-hero-actions .btn-secondary');

    if (heroPrimaryCta) {
      heroPrimaryCta.addEventListener('click', () => {
        trackHeroInteraction('cta_click', 'Start Your Project');
      });
    }

    if (heroSecondaryCta) {
      heroSecondaryCta.addEventListener('click', () => {
        trackHeroInteraction('cta_click', 'See What We Do');
      });
    }

    const ctaButton = document.querySelector('.cta-card .btn');
    if (ctaButton) {
      ctaButton.addEventListener('click', () => {
        trackContactAttempt('email', 'cta_card');
      });
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTracking);
  } else {
    initTracking();
  }

  document.addEventListener('astro:page-load', initTracking);
</script>
